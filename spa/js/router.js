var c=class{constructor(){this.hijackPopstate=e=>{"url"in e.state&&this.route(e.state.url,"replace")},this.hijackClick=e=>{if(e.target instanceof HTMLAnchorElement&&e.target.target!=="_blank"&&e.target.getAttribute("href")&&e.target.href.indexOf(location.origin)!==-1){e.preventDefault(),e.stopPropagation();let t=e.target.getAttribute("href"),i=e.target.getAttribute("history");i==="push"||i==="replace"?this.route(t,i):this.route(t)}},this.router={},this.mountingPoint=document.body,this.modules={}}configure(e){this.router={};for(let t in e)this.router[t.replace(/^\/|\/$/g,"")]=e[t];this.route(location.href,"replace"),document.addEventListener("click",this.hijackClick,{capture:!0}),window.addEventListener("popstate",this.hijackPopstate),this.dispatchEvent("ready")}mount(e){this.mountingPoint=e}navigateTo(e,t="push"){e.indexOf(location.origin)===0||e.indexOf("/")===0?this.route(e,t):location.href=e}pageJump(e,t="smooth"){let i=document.body.querySelector(`#${e.replace(/^\#/,"")}`);i&&i.scrollIntoView({behavior:t,block:"center",inline:"center"}),this.replaceState(`${location.origin}${location.pathname}${e}`)}replaceState(e){e=e.replace(location.origin,"").replace(/^\//,"").trim(),window.history.replaceState({url:e},document.title,`${location.origin}/${e}`)}pushState(e){e=e.replace(location.origin,"").replace(/^\//,"").trim(),window.history.pushState({url:e},document.title,`${location.origin}/${e}`)}mountElement(e,t,i){this.mountingPoint?.firstElementChild?.remove(),this.mountingPoint.appendChild(e),i==="replace"?this.replaceState(`${location.origin}/${t}`):this.pushState(`${location.origin}/${t}`)}async importModule(e){let t=null;try{t=await import(e)}catch(i){console.error(i)}return t}parseTokens(e,t){let i={};e=e.replace(/\?.*/,"").trim();let o=e.split("/");t=t.replace(/^\/|\/$/g,"").trim();let n=t.split("/");for(let r=0;r<n.length;r++)if(n[r].indexOf("{")===0&&n[r].indexOf("}")===n[r].length-1){let l=n[r].replace(/^\{|\}$/g,"").trim();i[l]=o[r]}return i}parseGetParams(e){let t={},i=e.match(/\?.*/)?.[0]??null;if(!i)return t;let o=new URLSearchParams(i);return o.forEach((n,r)=>{if(!t?.[r]){let l=o.getAll(r);l.length>1?t[r]=l:t[r]=l[0]}}),t}async import(e,t,i){if(e===null)throw"Missing route data.";let o=null,n=null;typeof e=="string"?(o=e,n=`./${e}.js`):(o=e.tagName,n=e.file);let r=this.parseTokens(t,i),l=this.parseGetParams(t);if(o===null||n===null)throw"Missing route data.";if(this.modules?.[o])return new this.modules[o].default(r,l);let a=await this.importModule(n);if(a===null)throw"Failed to dynamically import module.";if(!a?.default){let u=Object.keys(a)?.[0]??null;if(!u)throw"ES Module is exporting an empty object.";a=Object.assign({default:a[u]},a)}return this.modules[o]=a,customElements.get(o)||customElements.define(o,a.default),new this.modules[o].default(r,l)}lookupRoute(e){let t=null;e=e.replace(/\?.*|\#.*/g,"").replace(/^\/|\/$/g,"").trim();let i=e.split("/");for(let o in this.router){let n=o.split("/");if(n.length===i.length){let r=!0;for(let l=0;l<n.length;l++){let a=n[l].trim().toLowerCase();if(a==="*")break;if(!(a.indexOf("{")===0&&a.indexOf("}")===a.length-1)&&a!==i[l].trim().toLowerCase()){r=!1;break}}if(r){t=o;break}}}return t}async route(e,t="push"){if(e=e.replace(location.origin,"").replace(/^\/|\/$/g,"").trim(),e.indexOf("#")===0)this.pageJump(e);else{document.documentElement.setAttribute("router","loading"),this.dispatchEvent("loading");let i=null;this.router?.[e]?i=e:i=this.lookupRoute(e),i===null&&this.router?.["404"]&&(e="404",i=e);try{let o=await this.import(this.router[i],e,i);this.mountElement(o,e,t),e.indexOf("#")!==-1?this.pageJump(e.match(/\#.*/)[0],"auto"):o.scrollIntoView({block:"start",inline:"start",behavior:"auto"})}catch(o){console.error(o),location.href=`${location.origin}/404`}document.documentElement.setAttribute("router","idling"),this.dispatchEvent("loaded")}}dispatchEvent(e){var t=new CustomEvent(`router:${e}`);document.dispatchEvent(t)}},s=new c,h=s.navigateTo.bind(s),p=s.configure.bind(s),d=s.mount.bind(s),m=s.pageJump.bind(s),g=s.replaceState.bind(s),f=s.pushState.bind(s);export{p as configure,d as mount,h as navigateTo,m as pageJump,f as pushState,g as replaceState};
