var o=class{constructor(){this.inboxes={},this.queue=[],this.flushQueue();}flushQueue(){if(this.queue.length){let e=this.queue.splice(0,this.queue.length);for(let i=e.length-1;i>=0;i--)if(this.inboxes?.[e[i].recipient]){let s={data:e[i].data,replyId:e[i].senderId};for(let t=0;t<this.inboxes[e[i].recipient].length;t++)this.inboxes[e[i].recipient][t].inbox(s);e.splice(i,1);}else e[i].attempts++,e[i].attempts>=e[i].maxAttempts&&e.splice(i,1);this.queue=[...this.queue,...e];}setTimeout(this.flushQueue.bind(this),1e3);}sendMessage(e){if(this.inboxes?.[e.recipient]){let i={data:e.data,replyId:e.senderId};for(let s=0;s<this.inboxes[e.recipient].length;s++)this.inboxes[e.recipient][s].inbox(i);}else e.maxAttempts>1&&this.queue.push(e);}uid(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}register(e,i){let s=this.uid();return this.inboxes?.[e]||(this.inboxes[e]=[]),this.inboxes[e].push({id:s,inbox:i}),s}unregister(e){let i=!1;for(let s in this.inboxes){for(let t=0;t<this.inboxes[s].length;t++)if(this.inboxes[s][t].id===e){this.inboxes[s].splice(t,1),i=!0;break}if(i){this.inboxes[s].length===0&&delete this.inboxes[s];break}}}message(e){let i=Object.assign({maxAttempts:1,senderId:null,attempts:0,recipient:null,data:null},e);i.recipient!==null?this.sendMessage(i):console.error("Messaging Error: recipient field required.");}reply(e,i){if(e===null){console.error("Messaging error: replyId cannot be null");return}let s=!1;for(let t in this.inboxes){for(let r=0;r<this.inboxes[t].length;r++)if(this.inboxes[t][r].id===e){let l={data:i.data,replyId:i?.senderId??null};this.inboxes[t][r].inbox(l),s=!0;break}if(s)break}}},n=new o,u=n.register.bind(n),b=n.unregister.bind(n),d=n.message.bind(n),h=n.reply.bind(n);

export { d as message, u as register, h as reply, b as unregister };
