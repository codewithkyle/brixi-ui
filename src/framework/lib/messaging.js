var o=class{constructor(){this.inboxes={},this.queue=[],this.flushQueue();}flushQueue(){if(this.queue.length){let e=this.queue.splice(0,this.queue.length);for(let t=e.length-1;t>=0;t--)if(this.inboxes?.[e[t].recipient]){let i={data:e[t].data,replyId:e[t].senderId};for(let s=0;s<this.inboxes[e[t].recipient].length;s++)this.inboxes[e[t].recipient][s].inbox(i);}else e[t].attempts++,e[t].attempts>=e[t].maxAttempts&&e.splice(t,1);this.queue=[...this.queue,...e];}setTimeout(this.flushQueue.bind(this),1e3);}sendMessage(e){if(this.inboxes?.[e.recipient]){let t={data:e.data,replyId:e.senderId};for(let i=0;i<this.inboxes[e.recipient].length;i++)this.inboxes[e.recipient][i].inbox(t);}else e.maxAttempts>1&&this.queue.push(e);}uid(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}register(e,t){let i=this.uid();return this.inboxes?.[e]||(this.inboxes[e]=[]),this.inboxes[e].push({id:i,inbox:t}),i}unregister(e){let t=!1;for(let i in this.inboxes){for(let s=0;s<this.inboxes[i].length;s++)if(this.inboxes[i][s].id===e){this.inboxes[i].splice(s,1),t=!0;break}if(t){this.inboxes[i].length===0&&delete this.inboxes[i];break}}}message(e){let t=Object.assign({maxAttempts:1,senderId:null,attempts:0,recipient:null,data:null},e);t.recipient!==null&&t.data!==null&&this.sendMessage(t);}reply(e,t){if(e===null){console.error("Messaging error: replyId cannot be null");return}let i=!1;for(let s in this.inboxes){for(let r=0;r<this.inboxes[s].length;r++)if(this.inboxes[s][r].id===e){let l={data:t.data,replyId:t?.senderId??null};this.inboxes[s][r].inbox(l),i=!0;break}if(i)break}}},n=new o,b=n.register.bind(n),h=n.unregister.bind(n),d=n.message.bind(n),c=n.reply.bind(n);

export { d as message, b as register, c as reply, h as unregister };
