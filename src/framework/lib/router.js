var u=class{constructor(){this.hijackPopstate=t=>{"url"in t.state&&this.route(t.state.url,"replace");};this.hijackClick=t=>{if(t.target instanceof HTMLAnchorElement&&t.target.target!=="_blank"&&t.target.getAttribute("href")&&t.target.href.indexOf(location.origin)!==-1){t.preventDefault(),t.stopPropagation();let e=t.target.getAttribute("href"),i=t.target.getAttribute("history");i==="push"||i==="replace"?this.route(e,i):this.route(e);}};this.router={},this.mountingPoint=document.body,this.modules={};}configure(t){this.router={};for(let e in t)this.router[e.replace(/^\/|\/$/g,"")]=t[e];this.route(location.href,"replace"),document.addEventListener("click",this.hijackClick,{capture:!0}),window.addEventListener("popstate",this.hijackPopstate),this.dispatchEvent("ready");}mount(t){this.mountingPoint=t;}navigateTo(t,e="push"){t.indexOf(location.origin)===0||t.indexOf("/")===0?this.route(t,e):location.href=t;}pageJump(t,e="smooth"){let i=document.body.querySelector(`#${t.replace(/^\#/,"")}`);i&&i.scrollIntoView({behavior:e,block:"center",inline:"center"}),this.replaceState(`${location.origin}${location.pathname}${t}`);}replaceState(t){t=t.replace(location.origin,"").replace(/^\//,"").trim(),window.history.replaceState({url:t},document.title,`${location.origin}/${t}`);}pushState(t){t=t.replace(location.origin,"").replace(/^\//,"").trim(),window.history.pushState({url:t},document.title,`${location.origin}/${t}`);}mountElement(t,e,i){this.mountingPoint?.firstElementChild?.remove(),this.mountingPoint.appendChild(t),i==="replace"?this.replaceState(`${location.origin}/${e}`):this.pushState(`${location.origin}/${e}`);}async importModule(t){let e=null;try{e=await import(t);}catch(i){console.error(i);}return e}parseTokens(t,e){let i={};t=t.replace(/\?.*/,"").trim();let o=t.split("/");e=e.replace(/^\/|\/$/g,"").trim();let r=e.split("/");for(let n=0;n<r.length;n++)if(r[n].indexOf("{")===0&&r[n].indexOf("}")===r[n].length-1){let a=r[n].replace(/^\{|\}$/g,"").trim();i[a]=o[n];}return i}parseGetParams(t){let e={},i=t.match(/\?.*/)?.[0]??null;if(!i)return e;let o=new URLSearchParams(i);return o.forEach((r,n)=>{if(!e?.[n]){let a=o.getAll(n);a.length>1?e[n]=a:e[n]=a[0];}}),e}async import(t,e,i){if(t===null)throw "Missing route data.";let o=null,r=null;typeof t=="string"?(o=t,r=`./${t}.js`):(o=t.tagName,r=t.file);let n=this.parseTokens(e,i),a=this.parseGetParams(e);if(o===null||r===null)throw "Missing route data.";if(this.modules?.[o])return new this.modules[o].default(n,a);let s=await this.importModule(r);if(s===null)throw "Failed to dynamically import module.";if(!s?.default){let c=Object.keys(s)?.[0]??null;if(!c)throw "ES Module is exporting an empty object.";s=Object.assign({default:s[c]},s);}return this.modules[o]=s,customElements.get(o)||customElements.define(o,s.default),new this.modules[o].default(n,a)}lookupRoute(t){let e=null;t=t.replace(/\?.*|\#.*/g,"").replace(/^\/|\/$/g,"").trim();let i=t.split("/");for(let o in this.router){let r=o.split("/");if(r.length===i.length){let n=!0;for(let a=0;a<r.length;a++){let s=r[a].trim().toLowerCase();if(s==="*")break;if(s.indexOf("{")===0&&s.indexOf("}")===s.length-1)continue;if(s===i[a].trim().toLowerCase())continue;n=!1;break}if(n){e=o;break}}}return e}async route(t,e="push"){if(t=t.replace(location.origin,"").replace(/^\/|\/$/g,"").trim(),t.indexOf("#")===0)this.pageJump(t);else {document.documentElement.setAttribute("router","loading"),this.dispatchEvent("loading");let i=null;this.router?.[t]?i=t:i=this.lookupRoute(t),i===null&&this.router?.["404"]&&(t="404",i=t);try{let o=await this.import(this.router[i],t,i);this.mountElement(o,t,e),t.indexOf("#")!==-1?this.pageJump(t.match(/\#.*/)[0],"auto"):o.scrollIntoView({block:"start",inline:"start",behavior:"auto"});}catch(o){console.error(o),location.href=`${location.origin}/404`;}document.documentElement.setAttribute("router","idling"),this.dispatchEvent("loaded");}}dispatchEvent(t){var e=new CustomEvent(`router:${t}`);document.dispatchEvent(e);}},l=new u,h=l.navigateTo.bind(l),g=l.configure.bind(l),d=l.mount.bind(l),f=l.pageJump.bind(l),v=l.replaceState.bind(l),b=l.pushState.bind(l);

export { g as configure, d as mount, h as navigateTo, f as pageJump, b as pushState, v as replaceState };
